/*
Deployment script for DVIR

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "DVIR"
:setvar DefaultFilePrefix "DVIR"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
/*
The column [dbo].[DVIRPower].[NoRepairsNeededFlag] is being dropped, data loss could occur.

The column [dbo].[DVIRPower].[Remark1] is being dropped, data loss could occur.

The column [dbo].[DVIRPower].[Remark2] is being dropped, data loss could occur.

The type for column Belts in table [dbo].[DVIRPower] is currently  VARCHAR (20) NULL but is being changed to  BIT NULL. Data loss could occur.

The type for column GreaseLeak in table [dbo].[DVIRPower] is currently  VARCHAR (20) NULL but is being changed to  BIT NULL. Data loss could occur.

The type for column OilLeak in table [dbo].[DVIRPower] is currently  VARCHAR (20) NULL but is being changed to  BIT NULL. Data loss could occur.
*/

IF EXISTS (select top 1 1 from [dbo].[DVIRPower])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The column [dbo].[DVIRTowed].[CertifiedLocation] is being dropped, data loss could occur.
*/

IF EXISTS (select top 1 1 from [dbo].[DVIRTowed])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
PRINT N'Starting rebuilding table [dbo].[DVIRPower]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_DVIRPower] (
    [DVIRPowerId]           INT          IDENTITY (1, 1) NOT NULL,
    [DriverNo]              INT          NULL,
    [TractorId]             VARCHAR (11) NULL,
    [Location]              VARCHAR (20) NULL,
    [Mileage]               VARCHAR (10) NULL,
    [NoDefects]             BIT          NULL,
    [CabDoorsWindows]       BIT          NULL,
    [BodyDoors]             BIT          NULL,
    [OilLeak]               BIT          NULL,
    [GreaseLeak]            BIT          NULL,
    [CoolantLeak]           BIT          NULL,
    [FuelLeak]              BIT          NULL,
    [OtherGeneral]          VARCHAR (20) NULL,
    [GeneralRemark]         VARCHAR (40) NULL,
    [OilLevel]              BIT          NULL,
    [CoolantLevel]          BIT          NULL,
    [Belts]                 BIT          NULL,
    [OtherEngine]           VARCHAR (20) NULL,
    [EngineRemark]          VARCHAR (40) NULL,
    [GaugesWarning]         BIT          NULL,
    [WindshieldWipers]      BIT          NULL,
    [Horns]                 BIT          NULL,
    [HeaterDefroster]       BIT          NULL,
    [Mirrors]               BIT          NULL,
    [Steering]              BIT          NULL,
    [Clutch]                BIT          NULL,
    [ServiceBrakes]         BIT          NULL,
    [ParkingBrake]          BIT          NULL,
    [EmergencyBrake]        BIT          NULL,
    [Triangles]             BIT          NULL,
    [FireExtinguisher]      BIT          NULL,
    [OtherSafetyEquipment]  BIT          NULL,
    [SpareFuses]            BIT          NULL,
    [SeatBelts]             BIT          NULL,
    [OtherInCab]            VARCHAR (20) NULL,
    [InCabRemark]           VARCHAR (40) NULL,
    [Lights]                BIT          NULL,
    [Reflectors]            BIT          NULL,
    [Suspension]            BIT          NULL,
    [Tires]                 BIT          NULL,
    [WheelsRimsLugs]        BIT          NULL,
    [Battery]               BIT          NULL,
    [Exhaust]               BIT          NULL,
    [Brakes]                BIT          NULL,
    [AirLines]              BIT          NULL,
    [FifthWheel]            BIT          NULL,
    [OtherCoupling]         BIT          NULL,
    [TieDowns]              BIT          NULL,
    [OtherExterior]         VARCHAR (20) NULL,
    [ExteriorRemark]        VARCHAR (40) NULL,
    [CreatedDateTime]       DATETIME     NULL,
    [CertifyRepairsDate]    DATETIME     NULL,
    [RepairsMadeFlag]       BIT          NULL,
    [RONumber]              VARCHAR (20) NULL,
    [CertifiedBy]           VARCHAR (30) NULL,
    [CertifiedLocation]     VARCHAR (30) NULL,
    [ReviewingDriverDate]   DATETIME     NULL,
    [ReviewingDriverName]   VARCHAR (30) NULL,
    [ReviewingDriverNumber] VARCHAR (10) NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_DVIRPower] PRIMARY KEY CLUSTERED ([DVIRPowerId] ASC) ON [PRIMARY]
) ON [PRIMARY];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[DVIRPower])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_DVIRPower] ON;
        INSERT INTO [dbo].[tmp_ms_xx_DVIRPower] ([DVIRPowerId], [DriverNo], [TractorId], [Location], [Mileage], [NoDefects], [CabDoorsWindows], [BodyDoors], [OilLeak], [GreaseLeak], [CoolantLeak], [FuelLeak], [OtherGeneral], [OilLevel], [CoolantLevel], [Belts], [OtherEngine], [GaugesWarning], [WindshieldWipers], [Horns], [HeaterDefroster], [Mirrors], [Steering], [Clutch], [ServiceBrakes], [ParkingBrake], [EmergencyBrake], [Triangles], [FireExtinguisher], [OtherSafetyEquipment], [SpareFuses], [SeatBelts], [OtherInCab], [Lights], [Reflectors], [Suspension], [Tires], [WheelsRimsLugs], [Battery], [Exhaust], [Brakes], [AirLines], [FifthWheel], [OtherCoupling], [TieDowns], [OtherExterior], [CreatedDateTime], [CertifyRepairsDate], [RepairsMadeFlag], [RONumber], [CertifiedBy], [CertifiedLocation], [ReviewingDriverDate], [ReviewingDriverName], [ReviewingDriverNumber])
        SELECT   [DVIRPowerId],
                 [DriverNo],
                 [TractorId],
                 [Location],
                 [Mileage],
                 [NoDefects],
                 [CabDoorsWindows],
                 [BodyDoors],
                 [OilLeak],
                 [GreaseLeak],
                 [CoolantLeak],
                 [FuelLeak],
                 [OtherGeneral],
                 [OilLevel],
                 [CoolantLevel],
                 [Belts],
                 [OtherEngine],
                 [GaugesWarning],
                 [WindshieldWipers],
                 [Horns],
                 [HeaterDefroster],
                 [Mirrors],
                 [Steering],
                 [Clutch],
                 [ServiceBrakes],
                 [ParkingBrake],
                 [EmergencyBrake],
                 [Triangles],
                 [FireExtinguisher],
                 [OtherSafetyEquipment],
                 [SpareFuses],
                 [SeatBelts],
                 [OtherInCab],
                 [Lights],
                 [Reflectors],
                 [Suspension],
                 [Tires],
                 [WheelsRimsLugs],
                 [Battery],
                 [Exhaust],
                 [Brakes],
                 [AirLines],
                 [FifthWheel],
                 [OtherCoupling],
                 [TieDowns],
                 [OtherExterior],
                 [CreatedDateTime],
                 [CertifyRepairsDate],
                 [RepairsMadeFlag],
                 [RONumber],
                 [CertifiedBy],
                 [CertifiedLocation],
                 [ReviewingDriverDate],
                 [ReviewingDriverName],
                 [ReviewingDriverNumber]
        FROM     [dbo].[DVIRPower]
        ORDER BY [DVIRPowerId] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_DVIRPower] OFF;
    END

DROP TABLE [dbo].[DVIRPower];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_DVIRPower]', N'DVIRPower';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_DVIRPower]', N'PK_DVIRPower', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Altering [dbo].[DVIRTowed]...';


GO
ALTER TABLE [dbo].[DVIRTowed] DROP COLUMN [CertifiedLocation];


GO
PRINT N'Update complete.';


GO
