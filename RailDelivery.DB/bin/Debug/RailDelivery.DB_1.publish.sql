/*
Deployment script for DVIR

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "DVIR"
:setvar DefaultFilePrefix "DVIR"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Starting rebuilding table [dbo].[DVIRTowed]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_DVIRTowed] (
    [DVIRTowedId]           INT          IDENTITY (1, 1) NOT NULL,
    [DriverNo]              INT          NULL,
    [TrailerChassis]        VARCHAR (11) NULL,
    [Mileage]               VARCHAR (20) NULL,
    [Remark1]               VARCHAR (40) NULL,
    [Remark2]               VARCHAR (40) NULL,
    [NoDefects]             BIT          NULL,
    [BodyDoors]             BIT          NULL,
    [TieDowns]              BIT          NULL,
    [Lights]                BIT          NULL,
    [Reflectors]            BIT          NULL,
    [Suspension]            BIT          NULL,
    [Tires]                 BIT          NULL,
    [WheelsRimsLugs]        BIT          NULL,
    [Brakes]                BIT          NULL,
    [LandingGear]           BIT          NULL,
    [KingpinUpperPlate]     BIT          NULL,
    [FifthWheelDolly]       BIT          NULL,
    [OtherCoupling]         BIT          NULL,
    [RearEndProtection]     BIT          NULL,
    [Other]                 VARCHAR (20) NULL,
    [CreatedDateTime]       DATETIME     NULL,
    [CertifyRepairsDate]    DATETIME     NULL,
    [CertifiedLocation]     VARCHAR (30) NULL,
    [RepairsMadeFlag]       BIT          NULL,
    [NoRepairsNeededFlag]   BIT          NULL,
    [RONumber]              VARCHAR (20) NULL,
    [CertifiedBy]           VARCHAR (30) NULL,
    [Location]              VARCHAR (30) NULL,
    [ReviewingDriverDate]   DATETIME     NULL,
    [ReviewingDriverName]   VARCHAR (30) NULL,
    [ReviewingDriverNumber] VARCHAR (10) NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_DVIRTowed] PRIMARY KEY CLUSTERED ([DVIRTowedId] ASC) ON [PRIMARY]
) ON [PRIMARY];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[DVIRTowed])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_DVIRTowed] ON;
        INSERT INTO [dbo].[tmp_ms_xx_DVIRTowed] ([DVIRTowedId], [DriverNo], [TrailerChassis], [Mileage], [Remark1], [Remark2], [NoDefects], [BodyDoors], [TieDowns], [Lights], [Reflectors], [Suspension], [Tires], [WheelsRimsLugs], [Brakes], [LandingGear], [KingpinUpperPlate], [FifthWheelDolly], [OtherCoupling], [RearEndProtection], [Other], [CreatedDateTime], [CertifyRepairsDate], [RepairsMadeFlag], [NoRepairsNeededFlag], [RONumber], [CertifiedBy], [Location], [ReviewingDriverDate], [ReviewingDriverName], [ReviewingDriverNumber])
        SELECT   [DVIRTowedId],
                 [DriverNo],
                 [TrailerChassis],
                 [Mileage],
                 [Remark1],
                 [Remark2],
                 [NoDefects],
                 [BodyDoors],
                 [TieDowns],
                 [Lights],
                 [Reflectors],
                 [Suspension],
                 [Tires],
                 [WheelsRimsLugs],
                 [Brakes],
                 [LandingGear],
                 [KingpinUpperPlate],
                 [FifthWheelDolly],
                 [OtherCoupling],
                 [RearEndProtection],
                 [Other],
                 [CreatedDateTime],
                 [CertifyRepairsDate],
                 [RepairsMadeFlag],
                 [NoRepairsNeededFlag],
                 [RONumber],
                 [CertifiedBy],
                 [Location],
                 [ReviewingDriverDate],
                 [ReviewingDriverName],
                 [ReviewingDriverNumber]
        FROM     [dbo].[DVIRTowed]
        ORDER BY [DVIRTowedId] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_DVIRTowed] OFF;
    END

DROP TABLE [dbo].[DVIRTowed];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_DVIRTowed]', N'DVIRTowed';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_DVIRTowed]', N'PK_DVIRTowed', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Update complete.';


GO
